{"version":3,"file":"7-DZ4Qsayo.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(bare)/channel/_days_/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/7.js"],"sourcesContent":["import { g as getConnection } from \"../../../../../chunks/connection.js\";\nconst getPage = async (days) => {\n  const today = /* @__PURE__ */ new Date();\n  today.setDate(today.getDate() + days);\n  const iso = today.toISOString();\n  const arr = /^\\d\\d\\d\\d-(\\d\\d-\\d\\d)/.exec(iso) || [];\n  const [_, monthDay] = arr;\n  if (!monthDay) throw \"bad day\";\n  const client = await getConnection();\n  const pattern = `topic:*${monthDay}:*`;\n  const keys = await client.keys(pattern);\n  return {\n    page: days,\n    topics: await Promise.all(keys.map((key) => client.get(key))).then((topics) => topics.map((body, i) => ({ body, key: keys[i] })))\n  };\n};\nconst load = async ({ params }) => {\n  const { days } = params;\n  return getPage(+days);\n};\nconst actions = {\n  save: async ({ request, params }) => {\n    const data = await request.formData();\n    const topic = data.get(\"topic\")?.toString().trim();\n    const key = data.get(\"key\")?.toString().trim();\n    if (!(key && topic)) throw \"no key or topic\";\n    const client = await getConnection();\n    await client.set(key, topic);\n    const [_, date, id] = /.*\\:\\d{4}\\-([\\d\\-]+)\\:(\\d+)/.exec(key) || [];\n    if (!(date && id)) throw \"no date or id in the key\";\n    await client.sAdd(`approved:${date}`, +id + \"\");\n    const { days } = params;\n    return getPage(+days);\n  },\n  remove: async ({ request, params }) => {\n    const data = await request.formData();\n    const key = data.get(\"key\")?.toString().trim();\n    if (!key) throw \"no key to remove\";\n    const client = await getConnection();\n    await client.del(key);\n    const { days } = params;\n    return getPage(+days);\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/(bare)/channel/_days_/_page.server.ts.js';\n\nexport const index = 7;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(bare)/channel/_days_/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(bare)/channel/[days]/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/7.CN-B1Mwg.js\",\"_app/immutable/chunks/C-V7koEK.js\",\"_app/immutable/chunks/CuqPCOm1.js\",\"_app/immutable/chunks/CNXGhc8a.js\",\"_app/immutable/chunks/CDm-fcRQ.js\",\"_app/immutable/chunks/Bk6oNkak.js\",\"_app/immutable/chunks/CNUPf0XL.js\",\"_app/immutable/chunks/L2j9VugY.js\",\"_app/immutable/chunks/DIJY445-.js\",\"_app/immutable/chunks/DixeOKT8.js\",\"_app/immutable/chunks/iM5OWHQR.js\",\"_app/immutable/chunks/BO3cye2v.js\",\"_app/immutable/chunks/CHJ0qrLc.js\",\"_app/immutable/chunks/BfnAL8MM.js\",\"_app/immutable/chunks/Bi1xZXSP.js\"];\nexport const stylesheets = [\"_app/immutable/assets/7.DRH9gNme.css\",\"_app/immutable/assets/Alert.8vHm7ddm.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}