{"version":3,"file":"_server.ts-B1Tcy65c.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/publish/_webhook_/_id_/_server.ts.js"],"sourcesContent":["import { T as TELEGRAM_BOT_TOKEN, W as WEBHOOK, g as getConnection, p as prependZeroes, a as TELEGRAM_CHANNEL } from \"../../../../../chunks/connection.js\";\nimport { Telegram } from \"telegraf\";\nconst telegram = new Telegram(TELEGRAM_BOT_TOKEN);\nconst options = { parse_mode: \"Markdown\", link_preview_options: { is_disabled: true } };\nconst GET = async ({ params }) => {\n  const { webhook, id } = params;\n  if (webhook !== WEBHOOK) throw \"rejected\";\n  const pattern = `topic:*:${prependZeroes(id)}`;\n  const client = await getConnection();\n  const keys = await client.keys(pattern);\n  if (keys.length !== 1) throw \"strange count of keys\";\n  const [key] = keys;\n  const message = await client.get(key);\n  if (typeof message !== \"string\") throw \"bad message\";\n  await telegram.sendMessage(TELEGRAM_CHANNEL, message, options);\n  return new Response(\"ok\");\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;;;;;AAEA,MAAM,QAAQ,GAAG,IAAI,QAAQ,CAAC,kBAAkB,CAAC;AACjD,MAAM,OAAO,GAAG,EAAE,UAAU,EAAE,UAAU,EAAE,oBAAoB,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,EAAE;AAClF,MAAC,GAAG,GAAG,OAAO,EAAE,MAAM,EAAE,KAAK;AAClC,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,EAAE,GAAG,MAAM;AAChC,EAAE,IAAI,OAAO,KAAK,OAAO,EAAE,MAAM,UAAU;AAC3C,EAAE,MAAM,OAAO,GAAG,CAAC,QAAQ,EAAE,aAAa,CAAC,EAAE,CAAC,CAAC,CAAC;AAChD,EAAE,MAAM,MAAM,GAAG,MAAM,aAAa,EAAE;AACtC,EAAE,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;AACzC,EAAE,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,MAAM,uBAAuB;AACtD,EAAE,MAAM,CAAC,GAAG,CAAC,GAAG,IAAI;AACpB,EAAE,MAAM,OAAO,GAAG,MAAM,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC;AACvC,EAAE,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE,MAAM,aAAa;AACtD,EAAE,MAAM,QAAQ,CAAC,WAAW,CAAC,gBAAgB,EAAE,OAAO,EAAE,OAAO,CAAC;AAChE,EAAE,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC;AAC3B;;;;"}